<div *ngIf="show">
    <app-user-form (cancelForm)="showForm()"></app-user-form>
</div>

<h2>Gerenciamento de Perfil</h2>
<h5>Você pode adicionar novos usuários, alterar permissões existentes ou excluir usuários existentes.</h5>
<section>
    <div *ngIf="selectedUsers.length > 0" class="selection-indicator">
        {{ selectedUsers.length }} item(s) selecionado(s)
    </div>
    <div>
        <button>Todos os usuários <i class="bi bi-chevron-down"></i></button>
        <button (click)="showForm()">Novo usuário <i class="bi bi-plus-lg"></i></button>
    </div>
    <table>
        <thead>
            <tr>
                <th>
                    <input 
                    type="checkbox" 
                    [checked]="selectAll"
                    (change)="selectAll = !selectAll; toggleSelectAll()">
                </th>
                <th>USUÁRIO <i class="bi bi-person-lines-fill"></i></th>
                <th>EMAIL</th>
                <th>ROLE</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let usuario of usuarios">
            <td>
                <input 
                type="checkbox" 
                [checked]="isSelected(usuario.id)"
                (change)="toggleSelect(usuario.id)"
              >
            </td>
                <td>
                    <ng-container *ngIf="editingUser?.id === usuario.id; else displayUser">
                        <input 
                          type="text" 
                          [(ngModel)]="tempData.nomeUsuario" 
                          class="edit-input"
                        >
                    </ng-container>
                    <ng-template #displayUser>
                        {{ usuario.email }}
                    </ng-template>
                </td>
                <td>
                    <ng-container *ngIf="editingUser?.id === usuario.id; else displayUser">
                        <input 
                          type="text" 
                          [(ngModel)]="tempData.email" 
                          class="edit-input"
                        >
                    </ng-container>
                    <ng-template #displayUser>
                        {{ usuario.email }}
                    </ng-template>
                </td>
                <td>
                    <ng-container *ngIf="editingUser?.id === usuario.id; else displayCargo">
                        <select [(ngModel)]="tempData.cargo" class="edit-select">
                        <option value="AUTOR">AUTOR</option>
                        <option value="EDITOR">EDITOR</option>
                        <option value="ADMIN">ADMIN</option>
                        </select>
                    </ng-container>
                    <ng-template #displayCargo>
                        {{ usuario.cargo }}
                    </ng-template>
                </td>
                <td>
                    <ng-container *ngIf="editingUser?.id === usuario.id; else editButton">
                        <button (click)="saveEdit(usuario)" class="save-btn" title="Salvar alteração">
                        <i class="fas fa-save"></i>
                        </button>
                        <button (click)="cancelEdit()" class="cancel-btn" title="Cancelar edição">
                            <i class="fas fa-times"></i>
                        </button>
                    </ng-container>
                    <ng-template #editButton>
                        <button (click)="startEditing(usuario)" class="edit-btn" title="Editar usuário">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                    </ng-template>
                </td>
            </tr>
        </tbody>
    </table>
</section>